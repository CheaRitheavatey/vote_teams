================================================================================
SURVEY VALIDATION - HOW TO USE IT
================================================================================

WHAT IS THIS?
-------------
This is a tool that checks if your survey questions, blocks, and surveys are
valid before you actually create them. Think of it as a "test run". It catches
errors early so you don't waste time creating surveys that won't work.


HOW TO USE IT (THE BASICS)
---------------------------
Step 1: Import the functions you need

    from api.validation import validate_question_preview

Step 2: Call the validation when showing previews

    result = validate_question_preview(question_data, "ChoiceSingle")

Step 3: Check if it passed

    if result.success:
        # Good to go! Show the confirm button
    else:
        # Something's wrong, show the errors
        print(result.errors)


REAL EXAMPLE: VALIDATING A QUESTION
------------------------------------
When a user creates a question and you want to show them a preview:
    question_data = {
        "question": {"DE": "How satisfied are you?"},
        "config": {
            "option_type": "TEXT",
            "options": {
                "0": {"DE": "Very satisfied"},
                "1": {"DE": "Satisfied"}
            }
        },
        "settings": {"mandatory": True}
    }

    result = validate_question_preview(question_data, "ChoiceSingle")

    if result.success:
        # Show confirm button, let them proceed
    else:
        # Show errors, ask them to fix
        for error in result.errors:
            print(f"Problem: {error}")


REAL EXAMPLE: VALIDATING A BLOCK
---------------------------------
When validating a whole block of questions:
    block_data = {
        "title": {"DE": "Employee Satisfaction"},
        "description": {"DE": "Questions about your workplace"}
    }

    questions = [
        {
            "question": {"DE": "Are you satisfied?"},
            "question_type": "ChoiceSingle",
            "config": {"option_type": "TEXT", "options": {...}},
            "settings": {"mandatory": True}
        }
    ]

    result = validate_block_preview(block_data, questions)

    if result.success:
        # Block is good, let them continue
    else:
        # Show what needs fixing
        print(result.errors)


REAL EXAMPLE: VALIDATING A SURVEY
----------------------------------
Before creating the final survey:
    survey_config = {
        "title": {"DE": "Annual Survey 2025"},
        "description": {"DE": "Your feedback matters"},
        "settings": {"participation_mode": "UNGUIDED"}
    }

    blocks = {
        "0": {"title": {"DE": "Part 1"}, "questions": {...}}
    }

    result = validate_survey_preview(survey_config, blocks)

    if result.success:
        # Everything looks good, create the survey
    else:
        # Show what's wrong
        print(result.errors)


WHICH QUESTION TYPES WORK?
---------------------------
These work great:
  - ChoiceSingle (radio buttons)
  - ChoiceMulti (checkboxes)
  - GoodBad (thumbs up/down)

These don't work with the API yet:
  - Slider
  - TextInput

If you use Slider or TextInput, the system will do basic checks locally but
won't fully validate them against the API.


WHEN TO USE VALIDATION
-----------------------
Use it whenever you show a preview:

1. After user creates a question -> validate_question_preview()
2. After user creates a block -> validate_block_preview()
3. Before creating the final survey -> validate_survey_preview()


WHAT HAPPENS BEHIND THE SCENES
-------------------------------
The system does three things:

1. Quick local checks (does it have required fields?)
2. Fills in missing data (like survey settings) with dummy values
3. Sends it to the API to see if it would actually work

The API tells us if something's wrong, and we show those errors to the user.


DEALING WITH ERRORS
-------------------
When validation fails, you get back a list of errors. Just show these to the
user so they know what to fix.

Common errors you might see:
  - "At least one option is required for choice questions"
  - "Question text cannot be empty"
  - "Block must have at least one question"


TESTING IT OUT
--------------
Want to make sure everything works? Run this:

    python api/tests/test_validation.py

You should see all 7 tests pass.


COMMON PROBLEMS AND FIXES
--------------------------
Problem: Getting "429 Too Many Requests" errors
Fix: Open api/validation.py and increase RATE_LIMIT_DELAY to 2.0 or higher

Problem: Question type not supported
Fix: Only ChoiceSingle, ChoiceMulti, and GoodBad work right now. Stick to those.

Problem: Where do I put my API key?
Fix: Create a .env file in the project root with:
     API_KEY=your_key_here
     ADMIN_PASS=your_password_here


IMPORTANT TO KNOW
------------------
This validation system is completely optional and separate from everything else.
You can:
  - Use it in your part without affecting others
  - Not use it if you don't need it
  - Modify it without breaking anything else

All the code lives in api/validation.py and api/tests/


QUICK RECAP
-----------
1. Import the validation function you need
2. Call it when showing a preview
3. Check result.success
4. If true: let user continue
5. If false: show result.errors to the user and let the user fix them

That's it! Pretty straightforward.

================================================================================
